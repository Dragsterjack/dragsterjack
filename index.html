<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dragsterjack</title>
<meta name="description" content="Dragsterjack â€” Content creator focused on fun & outdoors.">
<link rel="icon" type="image/png" href="logo.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --white: #ffffff;
    --off-white: #f7f7f5;
    --black: #111111;
    --gray-1: #333;
    --gray-2: #666;
    --gray-3: #999;
    --gray-4: #ccc;
    --gray-5: #e8e8e6;
    --red: #c0392b;
    --red-light: #e74c3c;
    --red-bg: rgba(192,57,43,0.06);
    --green: #27ae60;
    --blue: #2980b9;
    --blue-bg: rgba(41,128,185,0.08);
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
    --shadow-md: 0 4px 20px rgba(0,0,0,0.08);
    --shadow-lg: 0 12px 40px rgba(0,0,0,0.12);
    --radius: 10px;
  }

  html { scroll-behavior: smooth; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--white);
    color: var(--black);
    min-height: 100dvh;
    -webkit-font-smoothing: antialiased;
  }

  /* â”€â”€ Main Layout â”€â”€ */
  .page {
    max-width: 520px;
    margin: 0 auto;
    padding: 48px 24px 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* â”€â”€ Avatar â”€â”€ */
  .avatar-ring {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    padding: 3px;
    background: linear-gradient(145deg, var(--black) 0%, var(--gray-2) 100%);
    animation: dropIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) both;
    cursor: pointer;
  }

  .avatar {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    object-position: top;
    display: block;
    border: 3px solid var(--white);
  }

  @keyframes dropIn {
    from { opacity: 0; transform: translateY(-20px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€ Identity â”€â”€ */
  .identity {
    text-align: center;
    margin-top: 28px;
    animation: fadeUp 0.5s ease-out 0.15s both;
  }

  .name {
    font-family: 'Oswald', sans-serif;
    font-weight: 700;
    font-size: 2rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--black);
    line-height: 1.1;
  }

  .bio {
    margin-top: 14px;
    font-size: 0.95rem;
    color: var(--gray-2);
    line-height: 1.65;
    max-width: 380px;
  }

  /* â”€â”€ Divider â”€â”€ */
  .divider {
    width: 40px;
    height: 2px;
    background: var(--gray-5);
    margin: 32px 0;
    animation: fadeUp 0.5s ease-out 0.25s both;
  }

  /* â”€â”€ Latest Post Card â”€â”€ */
  .latest-post {
    width: 100%;
    animation: fadeUp 0.5s ease-out 0.3s both;
    display: none;
  }

  .latest-post.visible { display: block; }

  .section-label {
    font-family: 'Oswald', sans-serif;
    font-size: 0.7rem;
    font-weight: 500;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--gray-3);
    margin-bottom: 14px;
  }

  .post-card {
    display: block;
    text-decoration: none;
    color: inherit;
    background: var(--white);
    border: 1px solid var(--gray-5);
    border-radius: var(--radius);
    overflow: hidden;
    transition: box-shadow 0.25s ease, transform 0.25s ease, border-color 0.25s ease;
  }

  .post-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
    border-color: var(--gray-4);
  }

  .post-banner {
    width: 100%;
    aspect-ratio: 16/9;
    object-fit: cover;
    display: block;
    background: var(--off-white);
  }

  .post-body { padding: 18px 20px 20px; }

  .post-platform-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--gray-3);
    margin-bottom: 8px;
  }

  .post-platform-badge svg { width: 13px; height: 13px; fill: currentColor; }

  .post-title {
    font-family: 'Oswald', sans-serif;
    font-weight: 700;
    font-size: 1.15rem;
    line-height: 1.3;
    color: var(--black);
  }

  .post-desc {
    margin-top: 8px;
    font-size: 0.88rem;
    color: var(--gray-2);
    line-height: 1.55;
  }

  /* â”€â”€ Social Links â”€â”€ */
  .links {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 32px;
  }

  .link-btn {
    display: flex;
    align-items: center;
    gap: 14px;
    width: 100%;
    padding: 14px 18px;
    background: var(--off-white);
    border: 1px solid transparent;
    border-radius: var(--radius);
    color: var(--black);
    text-decoration: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    transition: all 0.2s ease;
    cursor: pointer;
    animation: fadeUp 0.5s ease-out both;
  }

  .link-btn:hover {
    background: var(--white);
    border-color: var(--gray-5);
    box-shadow: var(--shadow-sm);
    transform: translateY(-1px);
  }

  .link-icon { width: 22px; height: 22px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
  .link-icon svg { width: 100%; height: 100%; fill: var(--gray-1); }

  .link-handle {
    margin-left: auto;
    font-size: 0.82rem;
    color: var(--gray-3);
    font-weight: 400;
  }

  /* â”€â”€ Footer â”€â”€ */
  .footer-row {
    margin-top: 48px;
    display: flex;
    align-items: center;
    gap: 8px;
    animation: fadeUp 0.5s ease-out 0.55s both;
  }

  .footer-text { font-size: 0.72rem; color: var(--gray-4); letter-spacing: 0.06em; }

  .admin-trigger {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    opacity: 0.15;
    transition: opacity 0.3s;
  }

  .admin-trigger:hover { opacity: 0.5; }
  .admin-trigger svg { width: 14px; height: 14px; fill: var(--gray-3); }

  /* â”€â”€ Modal â”€â”€ */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 1000;
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--white);
    border-radius: 14px;
    width: 100%;
    max-width: 520px;
    max-height: 92vh;
    overflow-y: auto;
    box-shadow: var(--shadow-lg);
    animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) both;
    display: flex;
    flex-direction: column;
  }

  @keyframes modalIn {
    from { opacity: 0; transform: scale(0.95) translateY(10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px 0;
    flex-shrink: 0;
  }

  .modal-title {
    font-family: 'Oswald', sans-serif;
    font-weight: 700;
    font-size: 1.1rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }

  .modal-close {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    color: var(--gray-3);
    font-size: 1.4rem;
    line-height: 1;
    transition: color 0.2s;
  }

  .modal-close:hover { color: var(--black); }

  /* â”€â”€ Tabs â”€â”€ */
  .tabs {
    display: flex;
    gap: 2px;
    padding: 16px 24px 0;
    border-bottom: 1px solid var(--gray-5);
    overflow-x: auto;
    flex-shrink: 0;
  }

  .tab-btn {
    background: none;
    border: none;
    padding: 8px 14px 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.82rem;
    font-weight: 700;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--gray-3);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    white-space: nowrap;
    transition: color 0.2s, border-color 0.2s;
  }

  .tab-btn.active {
    color: var(--black);
    border-bottom-color: var(--black);
  }

  .tab-btn:hover { color: var(--black); }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  .modal-body { padding: 20px 24px 24px; overflow-y: auto; }

  /* â”€â”€ Password Gate â”€â”€ */
  .pw-gate { display: flex; flex-direction: column; gap: 12px; }
  .pw-gate p { font-size: 0.88rem; color: var(--gray-2); }
  .input-row { display: flex; gap: 8px; }

  /* â”€â”€ Form Styles â”€â”€ */
  .field { margin-bottom: 16px; }

  .field-label {
    display: block;
    font-size: 0.78rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--gray-3);
    margin-bottom: 6px;
  }

  .field-hint {
    display: block;
    font-size: 0.75rem;
    color: var(--gray-3);
    margin-top: 4px;
    line-height: 1.4;
  }

  .field-input,
  .field-select,
  .field-textarea {
    width: 100%;
    padding: 10px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.92rem;
    color: var(--black);
    background: var(--off-white);
    border: 1px solid var(--gray-5);
    border-radius: 8px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .field-input:focus,
  .field-select:focus,
  .field-textarea:focus {
    border-color: var(--gray-4);
    box-shadow: 0 0 0 3px rgba(0,0,0,0.04);
  }

  .field-textarea { resize: vertical; min-height: 80px; }
  .field-select { cursor: pointer; }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 10px 20px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    font-weight: 700;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary { background: var(--black); color: var(--white); }
  .btn-primary:hover { background: var(--gray-1); transform: translateY(-1px); box-shadow: var(--shadow-sm); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .btn-secondary { background: var(--off-white); color: var(--gray-1); border: 1px solid var(--gray-5); }
  .btn-secondary:hover { background: var(--gray-5); }

  .btn-danger { background: var(--red-bg); color: var(--red); }
  .btn-danger:hover { background: rgba(192,57,43,0.12); }

  .btn-sm { padding: 6px 12px; font-size: 0.8rem; }

  .btn-row { display: flex; gap: 10px; margin-top: 8px; flex-wrap: wrap; }

  .error-msg { font-size: 0.82rem; color: var(--red); margin-top: 6px; }

  .success-msg {
    font-size: 0.85rem;
    color: var(--green);
    font-weight: 600;
    padding: 10px 14px;
    background: rgba(39,174,96,0.08);
    border-radius: 8px;
    margin-top: 12px;
  }

  .info-box {
    font-size: 0.82rem;
    color: var(--blue);
    padding: 10px 14px;
    background: var(--blue-bg);
    border-radius: 8px;
    margin-bottom: 16px;
    line-height: 1.5;
  }

  .info-box code {
    font-family: monospace;
    font-size: 0.82rem;
    background: rgba(41,128,185,0.12);
    padding: 1px 4px;
    border-radius: 3px;
  }

  .banner-preview {
    width: 100%;
    aspect-ratio: 16/9;
    object-fit: cover;
    border-radius: 8px;
    margin-top: 8px;
    display: none;
    border: 1px solid var(--gray-5);
  }

  .banner-preview.visible { display: block; }

  /* â”€â”€ Links Manager â”€â”€ */
  .links-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }

  .link-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: var(--off-white);
    border: 1px solid var(--gray-5);
    border-radius: 8px;
  }

  .link-item-label { flex: 1; font-size: 0.88rem; font-weight: 600; min-width: 0; }
  .link-item-url { flex: 1.5; font-size: 0.78rem; color: var(--gray-3); truncate: ellipsis; overflow: hidden; white-space: nowrap; min-width: 0; }
  .link-item-actions { display: flex; gap: 6px; flex-shrink: 0; }

  .add-link-form {
    padding: 16px;
    background: var(--off-white);
    border: 1px solid var(--gray-5);
    border-radius: 8px;
    margin-bottom: 12px;
  }

  .add-link-form h4 {
    font-family: 'Oswald', sans-serif;
    font-size: 0.8rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--gray-3);
    margin-bottom: 12px;
  }

  /* â”€â”€ Setup status â”€â”€ */
  .setup-status {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 0.82rem;
    font-weight: 600;
    margin-bottom: 16px;
  }

  .setup-status.connected { background: rgba(39,174,96,0.1); color: var(--green); }
  .setup-status.disconnected { background: var(--red-bg); color: var(--red); }
  .setup-status-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; }

  /* â”€â”€ SQL box â”€â”€ */
  .sql-box {
    background: #1a1a2e;
    color: #e0e0ff;
    border-radius: 8px;
    padding: 14px 16px;
    font-family: monospace;
    font-size: 0.78rem;
    line-height: 1.6;
    white-space: pre;
    overflow-x: auto;
    margin: 12px 0;
    position: relative;
  }

  .copy-sql-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(255,255,255,0.1);
    color: #aaa;
    border: none;
    border-radius: 5px;
    padding: 4px 8px;
    font-size: 0.72rem;
    cursor: pointer;
    transition: background 0.2s;
  }

  .copy-sql-btn:hover { background: rgba(255,255,255,0.2); color: white; }

  /* â”€â”€ Spinner â”€â”€ */
  .spinner {
    display: inline-block;
    width: 14px;
    height: 14px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€ Responsive â”€â”€ */
  @media (max-width: 480px) {
    .page { padding: 36px 20px 60px; }
    .avatar-ring { width: 120px; height: 120px; }
    .name { font-size: 1.7rem; }
    .link-handle { display: none; }
    .modal { max-height: 96vh; }
    .link-item-url { display: none; }
  }
</style>
</head>
<body>

<div class="page">

  <div class="avatar-ring" onclick="openAdmin()" title="Admin">
    <img class="avatar" id="siteAvatar" src="logo.png" alt="Dragsterjack" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23111%22 width=%22100%22 height=%22100%22/><text fill=%22%23fff%22 font-size=%2240%22 x=%2250%22 y=%2265%22 text-anchor=%22middle%22>DJ</text></svg>'">
  </div>

  <div class="identity">
    <h1 class="name" id="siteName">Dragsterjack</h1>
    <p class="bio" id="siteBio">I am a content creator out of the USA focused on anything that is fun &amp; outdoors. Mainly, I ride stuff with motors!</p>
  </div>

  <div class="divider"></div>

  <!-- Latest Post -->
  <div class="latest-post" id="latestPost">
    <p class="section-label">Latest Post</p>
    <a class="post-card" id="postCard" href="#" target="_blank" rel="noopener">
      <img class="post-banner" id="postBanner" src="" alt="">
      <div class="post-body">
        <div class="post-platform-badge" id="postPlatform"></div>
        <div class="post-title" id="postTitle"></div>
        <div class="post-desc" id="postDesc"></div>
      </div>
    </a>
  </div>

  <!-- Social Links -->
  <div class="links" id="socialLinks"></div>

  <div class="footer-row">
    <span class="footer-text" id="footerText">&copy; Dragsterjack 2025</span>
    <button class="admin-trigger" onclick="openAdmin()" aria-label="Admin">
      <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.48.48 0 00-.48-.41h-3.84a.48.48 0 00-.48.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96a.49.49 0 00-.59.22L2.74 8.87a.48.48 0 00.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.26.41.48.41h3.84c.24 0 .44-.17.48-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6A3.6 3.6 0 1115.6 12 3.61 3.61 0 0112 15.6z"/></svg>
    </button>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="adminModal">
  <div class="modal">

    <div class="modal-header">
      <span class="modal-title" id="modalTitle">Admin</span>
      <button class="modal-close" onclick="closeAdmin()">&times;</button>
    </div>

    <!-- Password Gate -->
    <div class="modal-body" id="pwGate">
      <div class="pw-gate">
        <p>Enter your admin password to continue.</p>
        <div class="input-row">
          <input type="password" class="field-input" id="pwInput" placeholder="Password" onkeydown="if(event.key==='Enter')checkPw()">
          <button class="btn btn-primary" onclick="checkPw()">Go</button>
        </div>
        <div class="error-msg" id="pwError" style="display:none;">Wrong password. Try again.</div>
      </div>
    </div>

    <!-- Admin Panel (shown after auth) -->
    <div id="adminPanel" style="display:none; flex-direction:column; flex:1; overflow:hidden;">

      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('setup')" id="tab-setup">âš™ Setup</button>
        <button class="tab-btn" onclick="switchTab('profile')" id="tab-profile">ğŸ‘¤ Profile</button>
        <button class="tab-btn" onclick="switchTab('post')" id="tab-post">ğŸ“Œ Post</button>
        <button class="tab-btn" onclick="switchTab('links')" id="tab-links">ğŸ”— Links</button>
      </div>

      <div class="modal-body">

        <!-- â”€â”€ SETUP TAB â”€â”€ -->
        <div class="tab-panel active" id="panel-setup">
          <div id="setupStatusBar"></div>

          <div class="info-box">
            <strong>First time?</strong> You need a free <a href="https://supabase.com" target="_blank">Supabase</a> account. Create a project, then run the SQL below to set up your tables.
          </div>

          <p style="font-size:0.82rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;color:var(--gray-3);margin-bottom:6px;">Step 1 â€” Run this SQL in Supabase â†’ SQL Editor</p>
          <div class="sql-box" id="sqlBox">-- Run this in Supabase â†’ SQL Editor â†’ New Query

create table if not exists site_config (
  id integer primary key default 1,
  name text default 'Dragsterjack',
  bio text default 'Content creator focused on fun & outdoors.',
  avatar_url text default '',
  footer_text text default 'Â© Dragsterjack 2025',
  constraint single_row check (id = 1)
);

create table if not exists site_links (
  id uuid primary key default gen_random_uuid(),
  label text not null,
  url text not null,
  handle text default '',
  icon text default 'link',
  sort_order integer default 0,
  created_at timestamptz default now()
);

create table if not exists site_post (
  id integer primary key default 1,
  platform text default 'youtube',
  title text default '',
  link text default '',
  banner text default '',
  description text default '',
  active boolean default false,
  constraint single_row check (id = 1)
);

-- Allow public read & write (admin password protects frontend)
alter table site_config enable row level security;
alter table site_links enable row level security;
alter table site_post enable row level security;

create policy "Public read config" on site_config for select using (true);
create policy "Public write config" on site_config for all using (true);
create policy "Public read links" on site_links for select using (true);
create policy "Public write links" on site_links for all using (true);
create policy "Public read post" on site_post for select using (true);
create policy "Public write post" on site_post for all using (true);

-- Seed default rows
insert into site_config (id) values (1) on conflict (id) do nothing;
insert into site_post (id) values (1) on conflict (id) do nothing;<button class="copy-sql-btn" onclick="copySQL()">Copy</button></div>

          <p style="font-size:0.82rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;color:var(--gray-3);margin-bottom:6px;margin-top:16px;">Step 2 â€” Enter your Supabase credentials</p>
          <div class="info-box">Find these in Supabase â†’ Project Settings â†’ API</div>

          <div class="field">
            <label class="field-label">Supabase Project URL</label>
            <input type="url" class="field-input" id="cfgUrl" placeholder="https://xyzxyzxyz.supabase.co">
          </div>
          <div class="field">
            <label class="field-label">Supabase Anon Key</label>
            <input type="text" class="field-input" id="cfgKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
            <span class="field-hint">The public "anon" key â€” safe to use in a website.</span>
          </div>
          <div class="btn-row">
            <button class="btn btn-primary" onclick="saveSupabaseCreds()" id="btnSaveCreds">Save & Connect</button>
            <button class="btn btn-secondary" onclick="clearCreds()">Clear Credentials</button>
          </div>
          <div id="setupMsg"></div>
        </div>

        <!-- â”€â”€ PROFILE TAB â”€â”€ -->
        <div class="tab-panel" id="panel-profile">
          <div class="field">
            <label class="field-label">Display Name</label>
            <input type="text" class="field-input" id="profName" placeholder="Dragsterjack">
          </div>
          <div class="field">
            <label class="field-label">Bio</label>
            <textarea class="field-textarea" id="profBio" placeholder="Tell visitors about yourself..."></textarea>
          </div>
          <div class="field">
            <label class="field-label">Avatar Image URL</label>
            <input type="url" class="field-input" id="profAvatar" placeholder="https://... (direct link to your photo)">
            <span class="field-hint">Paste a direct link to your profile photo. Try uploading to Imgur or Supabase Storage.</span>
          </div>
          <div class="field">
            <label class="field-label">Footer Text</label>
            <input type="text" class="field-input" id="profFooter" placeholder="Â© Dragsterjack 2025">
          </div>
          <div class="btn-row">
            <button class="btn btn-primary" onclick="saveProfile()" id="btnSaveProfile">Save Profile</button>
          </div>
          <div id="profileMsg"></div>
        </div>

        <!-- â”€â”€ POST TAB â”€â”€ -->
        <div class="tab-panel" id="panel-post">
          <div class="field" style="display:flex;align-items:center;justify-content:space-between;">
            <span style="font-size:0.88rem;font-weight:600;">Show Latest Post</span>
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
              <input type="checkbox" id="postActive" style="width:18px;height:18px;cursor:pointer;">
              <span style="font-size:0.82rem;color:var(--gray-3);" id="postActiveLabel">Off</span>
            </label>
          </div>

          <div class="field">
            <label class="field-label">Platform</label>
            <select class="field-select" id="formPlatform">
              <option value="youtube">YouTube</option>
              <option value="instagram">Instagram</option>
              <option value="tiktok">TikTok</option>
              <option value="x">X / Twitter</option>
              <option value="facebook">Facebook</option>
              <option value="twitch">Twitch</option>
            </select>
          </div>
          <div class="field">
            <label class="field-label">Title</label>
            <input type="text" class="field-input" id="formTitle" placeholder="My latest video...">
          </div>
          <div class="field">
            <label class="field-label">Link</label>
            <input type="url" class="field-input" id="formLink" placeholder="https://...">
          </div>
          <div class="field">
            <label class="field-label">Banner Image URL</label>
            <input type="url" class="field-input" id="formBanner" placeholder="https://...">
            <img class="banner-preview" id="bannerPreview" alt="Preview">
          </div>
          <div class="field">
            <label class="field-label">Description</label>
            <textarea class="field-textarea" id="formDesc" placeholder="Quick description..."></textarea>
          </div>
          <div class="btn-row">
            <button class="btn btn-primary" onclick="savePost()" id="btnSavePost">Save Post</button>
          </div>
          <div id="postMsg"></div>
        </div>

        <!-- â”€â”€ LINKS TAB â”€â”€ -->
        <div class="tab-panel" id="panel-links">

          <div class="add-link-form" id="addLinkForm" style="display:none;">
            <h4 id="addLinkFormTitle">Add New Link</h4>
            <input type="hidden" id="editLinkId">
            <div class="field">
              <label class="field-label">Label</label>
              <input type="text" class="field-input" id="linkLabel" placeholder="Instagram">
            </div>
            <div class="field">
              <label class="field-label">URL</label>
              <input type="url" class="field-input" id="linkUrl" placeholder="https://instagram.com/you">
            </div>
            <div class="field">
              <label class="field-label">Handle / Subtitle (optional)</label>
              <input type="text" class="field-input" id="linkHandle" placeholder="@you">
            </div>
            <div class="field">
              <label class="field-label">Icon</label>
              <select class="field-select" id="linkIcon">
                <option value="instagram">Instagram</option>
                <option value="youtube">YouTube</option>
                <option value="tiktok">TikTok</option>
                <option value="x">X / Twitter</option>
                <option value="facebook">Facebook</option>
                <option value="twitch">Twitch</option>
                <option value="spotify">Spotify</option>
                <option value="link">Generic Link</option>
              </select>
            </div>
            <div class="btn-row">
              <button class="btn btn-primary btn-sm" onclick="submitLinkForm()" id="btnLinkSubmit">Add Link</button>
              <button class="btn btn-secondary btn-sm" onclick="cancelLinkForm()">Cancel</button>
            </div>
            <div id="linkFormMsg"></div>
          </div>

          <div class="links-list" id="adminLinksList">
            <p style="color:var(--gray-3);font-size:0.88rem;text-align:center;padding:12px 0;">Loading links...</p>
          </div>

          <button class="btn btn-secondary" onclick="showAddLinkForm()" id="btnShowAddLink" style="width:100%;">+ Add New Link</button>
          <div id="linksMsg"></div>
        </div>

      </div><!-- .modal-body -->
    </div><!-- #adminPanel -->

  </div><!-- .modal -->
</div><!-- .modal-overlay -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONSTANTS & STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PW_HASH = '88056519922f4b7bc7b2b285c66c6f31ade6dc4959098676f689fc0525174b74';
let authed = false;
let sbClient = null;
let currentPost = null;
let currentLinks = [];
let currentConfig = {};

const PLATFORM_ICONS = {
  youtube: `<svg viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>`,
  instagram: `<svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>`,
  tiktok: `<svg viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>`,
  x: `<svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.744l7.73-8.835L1.254 2.25H8.08l4.253 5.622 5.911-5.622zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>`,
  facebook: `<svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>`,
  twitch: `<svg viewBox="0 0 24 24"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z"/></svg>`,
  spotify: `<svg viewBox="0 0 24 24"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>`,
  link: `<svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>`
};

const PLATFORM_NAMES = { youtube:'YouTube', instagram:'Instagram', tiktok:'TikTok', x:'X / Twitter', facebook:'Facebook', twitch:'Twitch', spotify:'Spotify', link:'Link' };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUPABASE INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initSupabase(url, key) {
  try {
    sbClient = window.supabase.createClient(url, key);
    return true;
  } catch(e) {
    return false;
  }
}

function loadCreds() {
  const url = localStorage.getItem('sb_url');
  const key = localStorage.getItem('sb_key');
  if (url && key) {
    initSupabase(url, key);
    return true;
  }
  return false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOAD SITE DATA ON PAGE LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadSiteData() {
  loadCreds();
  if (!sbClient) return;

  try {
    // Load config
    const { data: cfg } = await sbClient.from('site_config').select('*').eq('id', 1).single();
    if (cfg) {
      currentConfig = cfg;
      document.getElementById('siteName').textContent = cfg.name || 'Dragsterjack';
      document.getElementById('siteBio').textContent = cfg.bio || '';
      document.getElementById('footerText').textContent = cfg.footer_text || 'Â© Dragsterjack 2025';
      if (cfg.avatar_url) document.getElementById('siteAvatar').src = cfg.avatar_url;
    }

    // Load post
    const { data: post } = await sbClient.from('site_post').select('*').eq('id', 1).single();
    if (post && post.active && post.title) {
      currentPost = post;
      displayPost(post);
    }

    // Load links
    const { data: links } = await sbClient.from('site_links').select('*').order('sort_order').order('created_at');
    if (links && links.length) {
      currentLinks = links;
      renderLinks(links);
    }

  } catch(e) { /* Supabase not configured yet */ }
}

function displayPost(data) {
  document.getElementById('latestPost').classList.add('visible');
  document.getElementById('postCard').href = data.link || '#';
  document.getElementById('postTitle').textContent = data.title;
  document.getElementById('postDesc').textContent = data.description || '';

  const banner = document.getElementById('postBanner');
  if (data.banner) { banner.src = data.banner; banner.style.display = 'block'; }
  else { banner.style.display = 'none'; }

  const badge = document.getElementById('postPlatform');
  const icon = PLATFORM_ICONS[data.platform] || PLATFORM_ICONS.link;
  badge.innerHTML = icon + ' ' + (PLATFORM_NAMES[data.platform] || data.platform);
}

function renderLinks(links) {
  const container = document.getElementById('socialLinks');
  container.innerHTML = '';
  links.forEach((link, i) => {
    const a = document.createElement('a');
    a.className = 'link-btn';
    a.href = link.url;
    a.target = '_blank';
    a.rel = 'noopener';
    a.style.animationDelay = (0.35 + i * 0.07) + 's';
    a.innerHTML = `
      <span class="link-icon">${PLATFORM_ICONS[link.icon] || PLATFORM_ICONS.link}</span>
      <span>${link.label}</span>
      ${link.handle ? `<span class="link-handle">${link.handle}</span>` : ''}
    `;
    container.appendChild(a);
  });
}

loadSiteData();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PASSWORD CHECK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function hashStr(s) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(s));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

async function checkPw() {
  const val = document.getElementById('pwInput').value;
  const hash = await hashStr(val);
  if (hash === PW_HASH) {
    authed = true;
    document.getElementById('pwGate').style.display = 'none';
    document.getElementById('modalTitle').textContent = 'Admin Panel';
    document.getElementById('adminPanel').style.display = 'flex';
    loadAdminData();
  } else {
    document.getElementById('pwError').style.display = 'block';
    document.getElementById('pwInput').value = '';
    document.getElementById('pwInput').focus();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAdmin() {
  document.getElementById('adminModal').classList.add('open');
  if (!authed) {
    document.getElementById('pwGate').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'none';
    setTimeout(() => document.getElementById('pwInput').focus(), 100);
  } else {
    loadAdminData();
  }
}

function closeAdmin() {
  document.getElementById('adminModal').classList.remove('open');
}

document.getElementById('adminModal').addEventListener('click', function(e) {
  if (e.target === this) closeAdmin();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(name) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  document.getElementById('panel-' + name).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOAD ADMIN DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadAdminData() {
  updateSetupStatus();

  // Pre-fill setup
  document.getElementById('cfgUrl').value = localStorage.getItem('sb_url') || '';
  document.getElementById('cfgKey').value = localStorage.getItem('sb_key') || '';

  if (!sbClient) return;

  // Pre-fill profile
  if (currentConfig) {
    document.getElementById('profName').value = currentConfig.name || '';
    document.getElementById('profBio').value = currentConfig.bio || '';
    document.getElementById('profAvatar').value = currentConfig.avatar_url || '';
    document.getElementById('profFooter').value = currentConfig.footer_text || '';
  }

  // Pre-fill post
  if (currentPost) {
    document.getElementById('postActive').checked = currentPost.active || false;
    document.getElementById('formPlatform').value = currentPost.platform || 'youtube';
    document.getElementById('formTitle').value = currentPost.title || '';
    document.getElementById('formLink').value = currentPost.link || '';
    document.getElementById('formBanner').value = currentPost.banner || '';
    document.getElementById('formDesc').value = currentPost.description || '';
    if (currentPost.banner) {
      const prev = document.getElementById('bannerPreview');
      prev.src = currentPost.banner;
      prev.classList.add('visible');
    }
  }

  // Load post state from DB if not loaded yet
  refreshPostFromDB();

  updatePostActiveLabel();
  renderAdminLinks();
}

async function refreshPostFromDB() {
  if (!sbClient) return;
  const { data } = await sbClient.from('site_post').select('*').eq('id', 1).single();
  if (data) {
    currentPost = data;
    document.getElementById('postActive').checked = data.active || false;
    document.getElementById('formPlatform').value = data.platform || 'youtube';
    document.getElementById('formTitle').value = data.title || '';
    document.getElementById('formLink').value = data.link || '';
    document.getElementById('formBanner').value = data.banner || '';
    document.getElementById('formDesc').value = data.description || '';
    if (data.banner) {
      const prev = document.getElementById('bannerPreview');
      prev.src = data.banner;
      prev.classList.add('visible');
    }
    updatePostActiveLabel();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETUP TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateSetupStatus() {
  const bar = document.getElementById('setupStatusBar');
  const hasKey = !!localStorage.getItem('sb_key');
  if (hasKey && sbClient) {
    bar.innerHTML = `<div class="setup-status connected"><span class="setup-status-dot"></span>Connected to Supabase</div>`;
  } else {
    bar.innerHTML = `<div class="setup-status disconnected"><span class="setup-status-dot"></span>Not connected â€” enter credentials below</div>`;
  }
}

async function saveSupabaseCreds() {
  const url = document.getElementById('cfgUrl').value.trim();
  const key = document.getElementById('cfgKey').value.trim();
  const btn = document.getElementById('btnSaveCreds');
  const msg = document.getElementById('setupMsg');

  if (!url || !key) { msg.innerHTML = '<div class="error-msg">Both fields are required.</div>'; return; }

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Testing...';

  try {
    const ok = initSupabase(url, key);
    if (!ok) throw new Error('Invalid credentials format');

    // Test connection
    const { error } = await sbClient.from('site_config').select('id').eq('id', 1).single();
    if (error && error.code !== 'PGRST116') throw error;

    localStorage.setItem('sb_url', url);
    localStorage.setItem('sb_key', key);

    msg.innerHTML = '<div class="success-msg">âœ“ Connected! Loading your data...</div>';
    updateSetupStatus();
    await loadSiteData();
    loadAdminData();

  } catch(e) {
    msg.innerHTML = `<div class="error-msg">Connection failed: ${e.message}. Check your URL and key, and make sure you ran the SQL setup.</div>`;
    sbClient = null;
  }

  btn.disabled = false;
  btn.textContent = 'Save & Connect';
}

function clearCreds() {
  if (!confirm('Clear Supabase credentials?')) return;
  localStorage.removeItem('sb_url');
  localStorage.removeItem('sb_key');
  sbClient = null;
  document.getElementById('cfgUrl').value = '';
  document.getElementById('cfgKey').value = '';
  updateSetupStatus();
  document.getElementById('setupMsg').innerHTML = '<div class="success-msg">Credentials cleared.</div>';
}

function copySQL() {
  const sql = document.getElementById('sqlBox').innerText.replace('Copy', '').trim();
  navigator.clipboard.writeText(sql).then(() => {
    const btn = document.querySelector('.copy-sql-btn');
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = 'Copy', 2000);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROFILE TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function saveProfile() {
  if (!sbClient) { showMsg('profileMsg', 'error', 'Not connected to Supabase. Go to Setup tab first.'); return; }

  const btn = document.getElementById('btnSaveProfile');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>';

  const data = {
    id: 1,
    name: document.getElementById('profName').value.trim(),
    bio: document.getElementById('profBio').value.trim(),
    avatar_url: document.getElementById('profAvatar').value.trim(),
    footer_text: document.getElementById('profFooter').value.trim()
  };

  const { error } = await sbClient.from('site_config').upsert(data, { onConflict: 'id' });

  if (error) {
    showMsg('profileMsg', 'error', 'Error: ' + error.message);
  } else {
    currentConfig = data;
    // Update live
    if (data.name) document.getElementById('siteName').textContent = data.name;
    if (data.bio) document.getElementById('siteBio').textContent = data.bio;
    if (data.footer_text) document.getElementById('footerText').textContent = data.footer_text;
    if (data.avatar_url) document.getElementById('siteAvatar').src = data.avatar_url;
    showMsg('profileMsg', 'success', 'âœ“ Profile saved!');
  }

  btn.disabled = false;
  btn.textContent = 'Save Profile';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  POST TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('postActive').addEventListener('change', updatePostActiveLabel);
function updatePostActiveLabel() {
  const active = document.getElementById('postActive').checked;
  document.getElementById('postActiveLabel').textContent = active ? 'On' : 'Off';
}

document.getElementById('formBanner').addEventListener('input', function() {
  const prev = document.getElementById('bannerPreview');
  if (this.value) {
    prev.src = this.value;
    prev.classList.add('visible');
    prev.onerror = () => prev.classList.remove('visible');
  } else {
    prev.classList.remove('visible');
  }
});

async function savePost() {
  if (!sbClient) { showMsg('postMsg', 'error', 'Not connected to Supabase. Go to Setup tab first.'); return; }

  const btn = document.getElementById('btnSavePost');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>';

  const data = {
    id: 1,
    active: document.getElementById('postActive').checked,
    platform: document.getElementById('formPlatform').value,
    title: document.getElementById('formTitle').value.trim(),
    link: document.getElementById('formLink').value.trim(),
    banner: document.getElementById('formBanner').value.trim(),
    description: document.getElementById('formDesc').value.trim()
  };

  const { error } = await sbClient.from('site_post').upsert(data, { onConflict: 'id' });

  if (error) {
    showMsg('postMsg', 'error', 'Error: ' + error.message);
  } else {
    currentPost = data;
    if (data.active && data.title) {
      displayPost(data);
    } else {
      document.getElementById('latestPost').classList.remove('visible');
    }
    showMsg('postMsg', 'success', 'âœ“ Post saved! Changes are live.');
  }

  btn.disabled = false;
  btn.textContent = 'Save Post';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LINKS TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderAdminLinks() {
  if (!sbClient) {
    document.getElementById('adminLinksList').innerHTML = '<p style="color:var(--gray-3);font-size:0.88rem;text-align:center;padding:12px 0;">Connect Supabase in Setup tab first.</p>';
    return;
  }

  const { data, error } = await sbClient.from('site_links').select('*').order('sort_order').order('created_at');
  const list = document.getElementById('adminLinksList');

  if (error || !data || data.length === 0) {
    currentLinks = data || [];
    list.innerHTML = '<p style="color:var(--gray-3);font-size:0.88rem;text-align:center;padding:12px 0;">No links yet. Add your first one below!</p>';
    return;
  }

  currentLinks = data;
  list.innerHTML = '';

  data.forEach(link => {
    const div = document.createElement('div');
    div.className = 'link-item';
    div.innerHTML = `
      <span class="link-item-label">${escHtml(link.label)}</span>
      <span class="link-item-url">${escHtml(link.url)}</span>
      <div class="link-item-actions">
        <button class="btn btn-secondary btn-sm" onclick="editLink('${link.id}')">Edit</button>
        <button class="btn btn-danger btn-sm" onclick="deleteLink('${link.id}')">âœ•</button>
      </div>
    `;
    list.appendChild(div);
  });

  renderLinks(data);
}

function showAddLinkForm() {
  document.getElementById('editLinkId').value = '';
  document.getElementById('linkLabel').value = '';
  document.getElementById('linkUrl').value = '';
  document.getElementById('linkHandle').value = '';
  document.getElementById('linkIcon').value = 'instagram';
  document.getElementById('addLinkFormTitle').textContent = 'Add New Link';
  document.getElementById('btnLinkSubmit').textContent = 'Add Link';
  document.getElementById('addLinkForm').style.display = 'block';
  document.getElementById('btnShowAddLink').style.display = 'none';
  document.getElementById('linkFormMsg').innerHTML = '';
  document.getElementById('linkLabel').focus();
}

function editLink(id) {
  const link = currentLinks.find(l => l.id === id);
  if (!link) return;
  document.getElementById('editLinkId').value = id;
  document.getElementById('linkLabel').value = link.label;
  document.getElementById('linkUrl').value = link.url;
  document.getElementById('linkHandle').value = link.handle || '';
  document.getElementById('linkIcon').value = link.icon || 'link';
  document.getElementById('addLinkFormTitle').textContent = 'Edit Link';
  document.getElementById('btnLinkSubmit').textContent = 'Save Changes';
  document.getElementById('addLinkForm').style.display = 'block';
  document.getElementById('btnShowAddLink').style.display = 'none';
  document.getElementById('linkFormMsg').innerHTML = '';
}

function cancelLinkForm() {
  document.getElementById('addLinkForm').style.display = 'none';
  document.getElementById('btnShowAddLink').style.display = 'block';
}

async function submitLinkForm() {
  if (!sbClient) return;

  const id = document.getElementById('editLinkId').value;
  const label = document.getElementById('linkLabel').value.trim();
  const url = document.getElementById('linkUrl').value.trim();

  if (!label || !url) {
    document.getElementById('linkFormMsg').innerHTML = '<div class="error-msg">Label and URL are required.</div>';
    return;
  }

  const btn = document.getElementById('btnLinkSubmit');
  btn.disabled = true;

  const data = {
    label,
    url,
    handle: document.getElementById('linkHandle').value.trim(),
    icon: document.getElementById('linkIcon').value,
    sort_order: id ? (currentLinks.find(l=>l.id===id)?.sort_order || 0) : currentLinks.length
  };

  let error;
  if (id) {
    const res = await sbClient.from('site_links').update(data).eq('id', id);
    error = res.error;
  } else {
    const res = await sbClient.from('site_links').insert(data);
    error = res.error;
  }

  if (error) {
    document.getElementById('linkFormMsg').innerHTML = `<div class="error-msg">${error.message}</div>`;
  } else {
    cancelLinkForm();
    await renderAdminLinks();
    showMsg('linksMsg', 'success', 'âœ“ Link saved!');
  }

  btn.disabled = false;
  btn.textContent = id ? 'Save Changes' : 'Add Link';
}

async function deleteLink(id) {
  if (!confirm('Delete this link?')) return;
  const { error } = await sbClient.from('site_links').delete().eq('id', id);
  if (error) {
    showMsg('linksMsg', 'error', 'Error: ' + error.message);
  } else {
    await renderAdminLinks();
    showMsg('linksMsg', 'success', 'âœ“ Link deleted.');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showMsg(id, type, text) {
  const el = document.getElementById(id);
  el.innerHTML = `<div class="${type === 'error' ? 'error-msg' : 'success-msg'}">${text}</div>`;
  setTimeout(() => { if (el) el.innerHTML = ''; }, 4000);
}

function escHtml(str) {
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
</script>

</body>
</html>
